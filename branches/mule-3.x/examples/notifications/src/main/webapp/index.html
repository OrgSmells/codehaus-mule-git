<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Mule Notifications Example</title>

    <link rel="stylesheet" href="notifications.css"/>

    <script type="text/javascript" src="http://o.aolcdn.com/dojo/1.3.0/dojo/dojo.xd.js.uncompressed.js"></script>
    <script type="text/javascript" src="mule-resource/web/js/mule.js"></script>
    <script type="text/javascript">
        dojo.require("dojox.cometd");
        dojo.require("dojox.cometd.timestamp");

        function init()
        {
            mule.subscribe("/mule/notifications", notif);
            mule.subscribe("/services/test", rpcEchoResponse);
        }

        function dispose()
        {
            mule.unsubscribe("/mule/notifications", notif);
            mule.unsubscribe("/services/test", rpcEchoResponse);
        }

        function notif(message)
        {
            console.debug("data:" + message.data);

            if (!message.data)
            {
                console.debug("bad message format " + message);
                return;
            }
            var event = dojo.fromJson(message.data);
            var table = document.getElementById('notificationTable');
            var newRow = table.insertRow(1);
            newRow.className = event.type;


            newRow.insertCell(0).innerHTML = event.action;
            newRow.insertCell(1).innerHTML = event.type;
            newRow.insertCell(2).innerHTML = event.actionName;
            newRow.insertCell(3).innerHTML = event.source;
            newRow.insertCell(4).innerHTML = event.resourceIdentifier;
            newRow.insertCell(5).innerHTML = event.timestamp;

            table.scrollTop = table.scrollHeight - table.clientHeight
        }

        function rpcEcho() {
            var data = "{'phrase':'" + document.getElementById('phrase').value + "','user':'" + document.getElementById('user').value + "'}";
            mule.publish("/services/test", data);
        }

        function rpcEchoResponse(message) {
            document.getElementById("response").innerHTML = "<b>Response:</b>" + message.data + "\n";
        }

        dojo.addOnLoad(init);
        dojo.addOnUnload(dispose);


    </script>
</head>

<body>

<h1>Mule Notifications</h1>

<div>
    Secure Echo: <input id="phrase" type="text"/>
    <select id="user">
        <option value="anonymous">Anonymous</option>
        <option value="administrator" selected="true">Administrator</option>
    </select>
    <input id="sendButton" class="button" type="submit" name="Go" value="Send" onclick="rpcEcho();"/>
</div>

<pre id="response"></pre>
<p/>
<div style="position:relative;width:800px;height:300px;overflow:auto;">
<table id="notificationTable">
    <thead>
    <tr>
        <th width="5%">ID</th>
        <th width="5%">Type</th>
        <th width="15%">Action</th>
        <th width="35%">Source</th>
        <th width="30%">Resource ID</th>
        <th width="10%">Time</th>
    </tr>
    </thead>
</table>
    </div>
</body>
</html>